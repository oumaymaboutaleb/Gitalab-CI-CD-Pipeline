stages:          
  - build
  - test
  - deploy



test-job:   
  stage: test 
  image: node:14
  variables:
    MYSQL_ROOT_PASSWORD: root

  before_script:
    - apt update
    
    - apt-get install mariadb-server -y
    - /etc/init.d/mysql start
    -  mysql -h mysql -u root -p$MYSQL_ROOT_PASSWORD -e "ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY      '$MYSQL_ROOT_PASSWORD';"
    - mysql -u root -p -e "CREATE DATABASE student_test;"
    - npm install -g sequelize-cli 
    - npm install
    - sequelize db:migrate --env=test
    - npm install -g mocha 
    - npm install --save-dev nyc 
  script:
    - nyc mocha --exit

